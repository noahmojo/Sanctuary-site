<%- include('../partials/header', { settings, title: animal.name }) %>

<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <a href="/animals" class="inline-flex items-center gap-2 text-sm text-neutral-500 hover:text-neutral-900 transition mb-8">
      ‚Üê Back to Animals
    </a>
    
    <div class="grid md:grid-cols-2 gap-10">
      <!-- Photo Gallery -->
      <div>
        <% if (animal.photos && animal.photos.length > 0) { %>
          <!-- Main Photo -->
          <div class="aspect-square rounded-2xl overflow-hidden bg-neutral-100 mb-3 cursor-pointer" onclick="openLightbox(0)">
            <img id="main-photo" src="<%= animal.photos[0] %>" alt="<%= animal.name %>" class="w-full h-full object-cover hover:scale-105 transition duration-300">
          </div>
          
          <!-- Thumbnails -->
          <% if (animal.photos.length > 1) { %>
            <div class="flex gap-2 overflow-x-auto pb-2">
              <% animal.photos.forEach((photo, index) => { %>
                <button onclick="setMainPhoto('<%= photo %>', <%= index %>)" class="flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-neutral-100 border-2 transition <%= index === 0 ? 'border-emerald-500' : 'border-transparent hover:border-neutral-300' %>" id="thumb-<%= index %>">
                  <img src="<%= photo %>" alt="<%= animal.name %>" class="w-full h-full object-cover">
                </button>
              <% }); %>
            </div>
            <p class="text-xs text-neutral-400 mt-2 text-center">Tap photos to enlarge ‚Ä¢ Swipe thumbnails for more</p>
          <% } %>
        <% } else { %>
          <div class="aspect-square rounded-2xl bg-gradient-to-br from-amber-50 to-emerald-50 flex items-center justify-center text-8xl">
            <%= animal.species === 'Alpaca' ? 'ü¶ô' : 'üêë' %>
          </div>
        <% } %>
      </div>
      
      <!-- Info -->
      <div>
        <h1 class="text-4xl font-light mb-2"><%= animal.name %></h1>
        <% if (animal.nickname) { %>
          <p class="text-neutral-400 mb-4">aka "<%= animal.nickname %>"</p>
        <% } %>
        
        <div class="flex flex-wrap gap-2 mb-6">
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= animal.species %></span>
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= animal.breed %></span>
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= calcAge(animal.birthday) %> old</span>
        </div>
        
        <p class="text-lg text-emerald-600 mb-4"><%= animal.personality %></p>
        
        <p class="text-neutral-600 leading-relaxed mb-8"><%= animal.description %></p>
        
        <a href="/chat/<%= animal.id %>" class="inline-block bg-emerald-600 text-white px-8 py-3 rounded-full text-sm font-medium hover:bg-emerald-700 transition">
          Chat with <%= animal.name %>
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Lightbox -->
<% if (animal.photos && animal.photos.length > 0) { %>
<div id="lightbox" class="fixed inset-0 bg-black/90 z-50 hidden items-center justify-center" onclick="closeLightbox(event)">
  <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white/70 hover:text-white text-4xl">&times;</button>
  
  <% if (animal.photos.length > 1) { %>
    <button onclick="prevPhoto(event)" class="absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white text-4xl px-4 py-8">‚Äπ</button>
    <button onclick="nextPhoto(event)" class="absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white text-4xl px-4 py-8">‚Ä∫</button>
  <% } %>
  
  <img id="lightbox-img" src="" class="max-h-[90vh] max-w-[90vw] object-contain">
  
  <% if (animal.photos.length > 1) { %>
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white/70 text-sm">
      <span id="lightbox-counter">1</span> / <%= animal.photos.length %>
    </div>
  <% } %>
</div>

<script>
  const photos = <%- JSON.stringify(animal.photos) %>;
  let currentIndex = 0;
  
  function setMainPhoto(photo, index) {
    document.getElementById('main-photo').src = photo;
    currentIndex = index;
    document.querySelectorAll('[id^="thumb-"]').forEach((el, i) => {
      el.classList.remove('border-emerald-500');
      el.classList.add('border-transparent');
    });
    document.getElementById('thumb-' + index).classList.remove('border-transparent');
    document.getElementById('thumb-' + index).classList.add('border-emerald-500');
  }
  
  function openLightbox(index) {
    currentIndex = index;
    document.getElementById('lightbox-img').src = photos[currentIndex];
    document.getElementById('lightbox').classList.remove('hidden');
    document.getElementById('lightbox').classList.add('flex');
    document.getElementById('lightbox-counter').textContent = currentIndex + 1;
    document.body.style.overflow = 'hidden';
  }
  
  function closeLightbox(event) {
    if (event && event.target !== event.currentTarget) return;
    document.getElementById('lightbox').classList.add('hidden');
    document.getElementById('lightbox').classList.remove('flex');
    document.body.style.overflow = '';
  }
  
  function prevPhoto(event) {
    event.stopPropagation();
    currentIndex = (currentIndex - 1 + photos.length) % photos.length;
    document.getElementById('lightbox-img').src = photos[currentIndex];
    document.getElementById('lightbox-counter').textContent = currentIndex + 1;
  }
  
  function nextPhoto(event) {
    event.stopPropagation();
    currentIndex = (currentIndex + 1) % photos.length;
    document.getElementById('lightbox-img').src = photos[currentIndex];
    document.getElementById('lightbox-counter').textContent = currentIndex + 1;
  }
  
  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (document.getElementById('lightbox').classList.contains('hidden')) return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') prevPhoto(e);
    if (e.key === 'ArrowRight') nextPhoto(e);
  });
  
  // Touch swipe support
  let touchStartX = 0;
  document.getElementById('lightbox').addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
  });
  document.getElementById('lightbox').addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].clientX;
    const diff = touchStartX - touchEndX;
    if (Math.abs(diff) > 50) {
      if (diff > 0) nextPhoto(e);
      else prevPhoto(e);
    }
  });
</script>
<% } %>

<%- include('../partials/footer', { settings }) %>
