<%- include('../partials/header', { settings, title: animal.name }) %>

<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <a href="/animals" class="inline-flex items-center gap-2 text-sm text-neutral-500 hover:text-neutral-900 transition mb-8">
      ‚Üê Back to Animals
    </a>
    
    <div class="grid md:grid-cols-2 gap-10">
      <!-- Photo Gallery -->
      <div>
        <% if (animal.photos && animal.photos.length > 0) { %>
          <div id="main-photo-container" class="aspect-square rounded-2xl overflow-hidden bg-neutral-100 mb-3 cursor-pointer relative">
            <img id="main-photo" src="<%= animal.photos[0] %>" alt="<%= animal.name %>" class="w-full h-full object-cover">
          </div>
          
          <% if (animal.photos.length > 1) { %>
            <div class="flex gap-2 overflow-x-auto pb-2">
              <% animal.photos.forEach((photo, index) => { %>
                <button class="thumb-btn flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-neutral-100 border-2 transition <%= index === 0 ? 'border-emerald-500' : 'border-transparent hover:border-neutral-300' %>" data-index="<%= index %>" data-src="<%= photo %>">
                  <img src="<%= photo %>" alt="<%= animal.name %>" class="w-full h-full object-cover">
                </button>
              <% }); %>
            </div>
            <p class="text-xs text-neutral-400 mt-2 text-center">Tap thumbnails to switch ‚Ä¢ Tap main photo to enlarge</p>
          <% } %>
        <% } else { %>
          <div class="aspect-square rounded-2xl bg-gradient-to-br from-amber-50 to-emerald-50 flex items-center justify-center text-8xl">
            <%= animal.species === 'Alpaca' ? 'ü¶ô' : 'üêë' %>
          </div>
        <% } %>
      </div>
      
      <!-- Info -->
      <div>
        <h1 class="text-4xl font-light mb-2"><%= animal.name %></h1>
        <% if (animal.nickname) { %>
          <p class="text-neutral-400 mb-4">aka "<%= animal.nickname %>"</p>
        <% } %>
        
        <div class="flex flex-wrap gap-2 mb-6">
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= animal.species %></span>
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= animal.breed %></span>
          <span class="bg-neutral-100 px-3 py-1 rounded-full text-sm"><%= calcAge(animal.birthday) %> old</span>
        </div>
        
        <p class="text-lg text-emerald-600 mb-4"><%= animal.personality %></p>
        
        <p class="text-neutral-600 leading-relaxed mb-8"><%= animal.description %></p>
        
        <a href="/chat/<%= animal.id %>" class="inline-block bg-emerald-600 text-white px-8 py-3 rounded-full text-sm font-medium hover:bg-emerald-700 transition">
          Chat with <%= animal.name %>
        </a>
      </div>
    </div>
  </div>
</section>

<% if (animal.photos && animal.photos.length > 0) { %>
<!-- Lightbox -->
<div id="lightbox" class="fixed inset-0 bg-black z-50 hidden">
  <button id="lb-close" class="absolute top-4 right-4 text-white text-4xl z-10 w-12 h-12 flex items-center justify-center">&times;</button>
  
  <% if (animal.photos.length > 1) { %>
  <button id="lb-prev" class="absolute left-4 top-1/2 -translate-y-1/2 text-white text-5xl z-10 w-12 h-12 flex items-center justify-center">‚Äπ</button>
  <button id="lb-next" class="absolute right-4 top-1/2 -translate-y-1/2 text-white text-5xl z-10 w-12 h-12 flex items-center justify-center">‚Ä∫</button>
  <div id="lb-counter" class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm z-10"></div>
  <% } %>
  
  <div class="w-full h-full flex items-center justify-center p-4">
    <img id="lb-img" src="" class="max-w-full max-h-full object-contain">
  </div>
</div>

<script>
(function() {
  var photos = [<% animal.photos.forEach((p, i) => { %>'<%= p %>'<% if (i < animal.photos.length - 1) { %>,<% } %><% }); %>];
  var idx = 0;
  var mainPhoto = document.getElementById('main-photo');
  var mainContainer = document.getElementById('main-photo-container');
  var lightbox = document.getElementById('lightbox');
  var lbImg = document.getElementById('lb-img');
  var lbCounter = document.getElementById('lb-counter');
  var thumbs = document.querySelectorAll('.thumb-btn');
  
  function updateCounter() {
    if (lbCounter) lbCounter.textContent = (idx + 1) + ' / ' + photos.length;
  }
  
  function openLightbox() {
    lbImg.src = photos[idx];
    lightbox.style.display = 'block';
    document.body.style.overflow = 'hidden';
    updateCounter();
  }
  
  function closeLightbox() {
    lightbox.style.display = 'none';
    document.body.style.overflow = '';
  }
  
  function showPrev() {
    idx = (idx - 1 + photos.length) % photos.length;
    lbImg.src = photos[idx];
    updateCounter();
  }
  
  function showNext() {
    idx = (idx + 1) % photos.length;
    lbImg.src = photos[idx];
    updateCounter();
  }
  
  // Thumbnail clicks
  thumbs.forEach(function(btn) {
    btn.addEventListener('click', function() {
      idx = parseInt(this.getAttribute('data-index'));
      mainPhoto.src = photos[idx];
      thumbs.forEach(function(b) {
        b.classList.remove('border-emerald-500');
        b.classList.add('border-transparent');
      });
      this.classList.remove('border-transparent');
      this.classList.add('border-emerald-500');
    });
  });
  
  // Open lightbox
  mainContainer.addEventListener('click', openLightbox);
  
  // Close
  document.getElementById('lb-close').addEventListener('click', closeLightbox);
  lightbox.addEventListener('click', function(e) {
    if (e.target === lightbox) closeLightbox();
  });
  
  // Nav
  var prevBtn = document.getElementById('lb-prev');
  var nextBtn = document.getElementById('lb-next');
  if (prevBtn) prevBtn.addEventListener('click', function(e) { e.stopPropagation(); showPrev(); });
  if (nextBtn) nextBtn.addEventListener('click', function(e) { e.stopPropagation(); showNext(); });
  
  // Keyboard
  document.addEventListener('keydown', function(e) {
    if (lightbox.style.display !== 'block') return;
    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowLeft') showPrev();
    if (e.key === 'ArrowRight') showNext();
  });
  
  // Swipe
  var startX = 0;
  lightbox.addEventListener('touchstart', function(e) { startX = e.touches[0].clientX; });
  lightbox.addEventListener('touchend', function(e) {
    var diff = startX - e.changedTouches[0].clientX;
    if (Math.abs(diff) > 50) {
      if (diff > 0) showNext();
      else showPrev();
    }
  });
})();
</script>
<% } %>

<%- include('../partials/footer', { settings }) %>
